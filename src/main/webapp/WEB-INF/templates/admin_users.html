<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Пользователи — админ</title>
    <link rel="stylesheet" href="/assets/css/app.css">
    <style>
        table { width:100%; border-collapse: collapse; margin-top:12px; }
        th, td { padding:8px 10px; border-bottom:1px solid #eee; }
        .badge { padding:2px 8px; border-radius:12px; font-size:12px; }
        .on { background:#e6ffed; }
        .off { background:#ffecec; }
        .actions { display:flex; gap:8px; justify-content:flex-end; }
        form { display:inline; }
    </style>
</head>
<body>
<div class="container">
    <h1>Пользователи</h1>

    <div th:if="${users == null or users.isEmpty()}">
        <p>Пользователей нет.</p>
        <a class="mac-link" href="/admin">Назад</a>
    </div>

    <div th:if="${users != null and !users.isEmpty()}">
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>Имя</th>
                <th>Email</th>
                <th>Роль</th>
                <th>Статус</th>
                <th style="text-align:right;">Действия</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="u : ${users}">
                <td th:text="${u.id}">1</td>
                <td th:text="${u.name}">Имя</td>
                <td th:text="${u.email}">email@example.com</td>
                <td th:text="${u.role}">USER</td>
                <td>
          <span class="badge" th:classappend="${u.isActive} ? ' on' : ' off'"
                th:text="${u.isActive} ? 'Активен' : 'Заблокирован'">Активен</span>
                </td>
                <td class="actions">
                    <!-- Кнопки доступны только админу и не для админ-пользователей -->
                    <div th:if="${session.role == T(model.Role).ADMIN and u.role != T(model.Role).ADMIN}">
                        <form method="post" th:action="@{/admin/users}">
                            <input type="hidden" name="id" th:value="${u.id}">
                            <input type="hidden" name="action" value="block">
                            <button type="submit" th:if="${u.isActive}">Заблокировать</button>
                        </form>
                        <form method="post" th:action="@{/admin/users}">
                            <input type="hidden" name="id" th:value="${u.id}">
                            <input type="hidden" name="action" value="unblock">
                            <button type="submit" th:if="${!u.isActive}">Разблокировать</button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <a class="mac-link" href="/admin">Назад</a>
    </div>
</div>
</body>
</html>
